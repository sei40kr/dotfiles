#!/usr/bin/env bash

: ${GHQ_ROOT:=$(ghq root)}

repo="$(ghq list | eval "fzf-tmux ${FZF_TMUX_OPTS}")"

if [[ -z "$repo" ]]; then
  exit
fi

session="$repo"
session="${session##*/}"
session="${session//+([0-9a-zA-Z-_])/_}"
session="${session#_}"
session="${session%_}"
dir="${GHQ_ROOT}/${repo}"

if ! tmux has-session -t "$session" 2>/dev/null; then
  tmux new-session -dc "$dir" -s "$session" \; \
       set-option -t "$session" destroy-unattached off
fi

tmux switch-client -t "$session"
